WDK Template Site Setup Notes

Congratulations on making the Strategies WDK part of your data access tools.  Installing and using WDK can be difficult, so we've provided a template site to get you started.  Once you get it working you can gradually tweak it to meet your needs.  It exhibits a number of features you may want to use; by providing examples we hope you will more easily take advantage of those features.

Prerequisites (successfully tested):

 - Unix-like OS (tested LinuxMint 17)
 - Subversion 1.8.8
 - Perl 5.18.2
 - Perl YAML module
 - Java 1.7
 - NPM (Node Package Manager) 1.3.10
 - Ant 1.9.3
 - Maven 3.0.5
 - Tomcat 7 (Note: 8 will NOT work for now)
 - PostgreSQL 8+ (used 9.3)

Database Setup:

It's most convenient to have your database set up in advance of installing the WDK template site.  Our setup script assumes you are running PostgreSQL on localhost:5432 (the default postgres port).  It also assumes you can create a role, and database owned by that role, both named "wdktemplatedb".  This database will store both user data (so users of your site can save and share strategies), and application data (the data you want to search).  Later, you can change the AppDB to point to your own data store; the template site data can remain, or you can delete it.  On to the setup:

Assume using local PostgreSQL (9.3) with the following DB objects:
  User/Role: wdktemplatedb/<db_password>
  Database: wdktemplatedb

1. Install PostgreSQL (ideally via apt, etc.) and start the server
2. Become postgres admin (from a sudo user):
   > sudo su postgres
3. Get DB prompt using postgres user:
   > psql
4. Create role above
   postgres=# create role wdktemplatedb login password '<db_password>';
5. Create database above
   postgres=# create database wdktemplatedb owner wdktemplatedb;

Installing the WDK Template Site

Now that your database is ready, you can install the WDK source code, build the site, and create the required tables in your database.  There is a handy script to do so here:

https://www.cbil.upenn.edu/svn/gus/WDKTemplateSite/trunk/Site/bin/createTemplateSite.sh

Download the script and run it.  It takes three arguments:

  install_dir: This is a directory where the site will be installed.  This directory should be created by the script; specify the dir to create, not its parent

  db_password: Assuming you followed the steps above, but with a different password, pass your wdktemplatedb user's password here

  template_site_host: This is the host at which the webapp will live.  For testing, this might be 'http://localhost:8080' or similar

The script tests for required prerequisites.  If it fails, install the identified prereq and try again.

The menu will show you the steps involved in creating a site.  To run all the steps, select the 'All' option.  If you've already created the database tables but this is a new template site, select the 'All Except DB' option.  To go one step at a time, use the other options.

Follow-up Steps

If you select one of the 'All' options in the script , you will receive the following message:

Please check logs for errors in <template_site_dir>/logs
There are three more steps to running the WDK Template Site
  1. Download the PostgreSQL JDBC database driver and install in Tomcat
    a. Download from: http://jdbc.postgresql.org/download.html
    b. Place in $CATALINA_HOME/lib
  2. Copy the template site context.xml file to Tomcat
    a. cp <template_site_dir>/etc/wdkTemplateSite.xml $CATALINA_HOME/conf/Catalina/localhost
  3. Set the environment and restart Tomcat
    a. $CATALINA_HOME/bin/shutdown.sh
    b. source <template_site_dir>/etc/envSetup.sh
    c. $CATALINA_HOME/bin/startup.sh

Completing these steps should complete the installation process.  The template site should not be available in your Tomcat instance under the webapp 'wdkTemplateSite'.
